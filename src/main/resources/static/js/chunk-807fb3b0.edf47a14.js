(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-807fb3b0"],{4134:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"document"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 文件管理\n      ")])],1)],1),a("div",{staticClass:"document-content"},[a("div",{staticClass:"document-content-card"},[a("el-row",{staticClass:"tac"},[a("el-col",{attrs:{span:5}},[a("div",{staticClass:"drag-box-item"},[a("el-input",{staticClass:"el",attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-tree",{ref:"tree",staticClass:"mulu",staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",display:"block","margin-top":"10px"},attrs:{"show-checkbox":"","default-expand-all":"",data:e.docLabelsTree,"node-key":"id","filter-node-method":e.filterNode},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return a("span",{staticClass:"span-ellipsis"},[a("span",{attrs:{title:n.label}},[e._v(e._s(n.label))])])}}])})],1)]),a("el-col",{staticStyle:{padding:"20px","padding-left":"0px"},attrs:{span:19}},[a("div",{staticClass:"document-search"},[a("el-row",{staticClass:"document-search-label",attrs:{gutter:25}},[a("ul",e._l(e.allTags,function(t){return a("el-tag",{key:t.tagId,staticStyle:{cursor:"pointer"},attrs:{type:t.type,"disable-transitions":!0},on:{click:function(a){return e.chooseTag(t)},close:function(a){return e.handleClose(t)}}},[e._v(e._s(t.tagName))])}),1)]),a("el-row",{staticClass:"document-search-multipleConditions",attrs:{gutter:25}},[a("el-col",{attrs:{span:4}},[a("el-input",{attrs:{placeholder:"文件名"},model:{value:e.docSearchName,callback:function(t){e.docSearchName=t},expression:"docSearchName"}})],1),a("el-col",{attrs:{span:4}},[a("el-cascader",{attrs:{placeholder:"输入部门",options:e.departments,filterable:"","change-on-select":!0,clearable:""},on:{change:e.selectDepartment},model:{value:e.departs,callback:function(t){e.departs=t},expression:"departs"}})],1),a("el-col",{attrs:{span:7}},[a("el-date-picker",{attrs:{type:"year",placeholder:"选择年"},model:{value:e.selectYear,callback:function(t){e.selectYear=t},expression:"selectYear"}})],1),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")])],1)],1)],1),a("div",{staticClass:"document-display"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"10px"},attrs:{data:e.tableData,stripe:"","row-class-name":e.tableRowClassName}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"附件:"}},e._l(t.row.annexes,function(t){return a("span",{key:t.annexId},[e._v("\n                        "+e._s(t.annexName)+"\n                        "),a("el-button",{staticStyle:{"margin-right":"25px","margin-left":"25px"},attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.downLoadAnnex(t)}}},[e._v("下载")])],1)}),0)],1)]}}])}),a("el-table-column",{attrs:{prop:"docName",label:"文件名"}}),a("el-table-column",{attrs:{prop:"docNumber",label:"文件标号"}}),a("el-table-column",{attrs:{prop:"departmentName",label:"所属部门"}}),a("el-table-column",{attrs:{prop:"docPostTime",sortable:"",formatter:e.dateTimeFormat,label:"发文日期"}}),a("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return e.download(t.row)}}},[e._v("下载")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"normal"},on:{click:function(a){return e.perview(t.row)}}},[e._v("预览")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.delDoc(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":e.pageSize,total:e.total,"current-page":e.currentPage},on:{"current-change":e.handleCurrentChange}})],1),a("el-dialog",{staticStyle:{height:"100%"},attrs:{title:"预览",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-pagination",{staticStyle:{"margin-left":"20%","margin-top":"-50px"},attrs:{"current-page":e.currentPage1,"page-size":1,layout:"total, prev, pager, next",total:e.pageCount},on:{"size-change":e.handlePreSizeChange,"current-change":e.handlePreCurrentChange,"update:currentPage":function(t){e.currentPage1=t},"update:current-page":function(t){e.currentPage1=t}}}),a("pdf",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"80%",height:"30%",margin:"0 auto","margin-top":"20px"},attrs:{src:e.src,page:e.currentPage1},on:{loaded:e.loadPdfHandler,"num-pages":function(t){e.pageCount=t}}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible1,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible1=t}}},[a("span",[e._v("是否选择下载文件及附件?")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.singledownload}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.batchdownload}},[e._v("确 定")])],1)])],1)])],1)],1)])])},o=[],s=a("bd86"),l=(a("28a5"),a("858e")),i=a("56d7"),c=a("c1df"),r=a.n(c),d=(a("3022"),{components:{pdf:l["a"]},created:function(){var e={Authorization:"Bearer SOME_TOKEN","x-ipp-device-uuid":"SOME_UUID","x-ipp-client":"SOME_ID","x-ipp-client-version":"SOME_VERSION"};l["a"].createLoadingTask({url:this.src,httpHeaders:e});this.src=l["a"].createLoadingTask(this.src)},methods:{getPagePermissions:function(){Object(i["postJsonRequest"])("/public/getPagePermission").then(function(e){var t=e.data.data[0].pagePermission.split(";");console.log(t),t.push("login"),t.push("403"),console.log(t),localStorage.setItem("permissions",t)}).catch(function(e){})},open3:function(e){void 0==e&&(e="这是一条成功的提示消息"),this.$notify({title:"成功",message:e,type:"success"})},open6:function(e){void 0==e&&(e="这是一条错误的提示消息"),this.$notify.error({title:"错误",message:e})},batchdownload:function(){console.log("单一"),console.log(this.url.split("?"));var e=this.url.split("?"),t="/public/downloadZip?"+e[1];console.log(t),window.location.href=t,this.dialogVisible1=!1},singledownload:function(){console.log("批量"),console.log(this.url),window.location.href=this.url,this.dialogVisible1=!1},handlePreSizeChange:function(e){console.log("每页 ".concat(e," 条"))},handlePreCurrentChange:function(e){this.currentPage1=e,window.scrollTo(0,0)},loadPdfHandler:function(){this.currentPage1=1},perview:function(e){var t=this;this.src="",console.log(e);var a={FilePath:e.docSavePath};Object(i["postRequest"])("/public/preViewFile",a).then(function(e){var a="/file/"+e.data.data.substring(e.data.data.lastIndexOf("\\")+1);t.src=a,200!=e.data.code&&t.open6(e.data.msg),t.loading=!1}).catch(function(e){}),this.dialogVisible=!0,window.scrollTo(0,0)},getherf:function(e){return console.log(4444),e.url},downLoadFileAndAnnex:function(e){console.log(e),Object(i["postJsonRequest"])("/public/downloadFileAndAnnex",e).then(function(e){}).catch(function(e){})},download:function(e){this.dialogVisible1=!0;var t=e.url+"&token="+localStorage.getItem("token");this.url=t},selectDepartment:function(e){null!=e&&e.length>0&&(this.selectDepartmentId=e[e.length-1],console.log(this.selectDepartmentId))},toUploadPage:function(){this.$router.push({path:"Upload"})},selectDocument:function(e){console.log(e),this.selectDocumentInfo=e,this.dynamicTags=this.selectDocumentInfo.tags,this.checkfileList.push(e),console.log("list:"+JSON.stringify(this.checkfileList))},handleCheckAllChange:function(e){this.checkList=e?this.allCheckList:[],this.isIndeterminate=!1},downLoadAnnex:function(e){console.log(e),window.location.href="/getName?name="+e.annexName+"&token="+localStorage.getItem("token")},tableRowClassName:function(e){e.row;var t=e.rowIndex;return t%4===1?"warning-row":t%4===3?"success-row":""},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},delDoc:function(e,t){var a=this;this.$confirm("是否要删除该文件?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){if("confirm"==e){a.$notify.success({title:"提示",message:"文件删除成功"}),console.log(t);for(var n=0;n<a.tableData.length;n++)a.tableData[n].docId==t.docId&&a.tableData.splice(n,1)}}).catch(function(e){})},handleOpen:function(){},handleClose:function(){},handleCurrentChange:function(e){this.currentPage=e,this.getDocsBySearchParam()},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus()})},chooseTag:function(e){if(console.log(e),"normal"===e.type)e.type="danger",this.tags.push(e);else{e.type="normal",console.log(this.tags.indexOf(e));for(var t=0;t<this.tags.length;t++)this.tags[t].tagId==e.tagId&&this.tags.splice(t,1)}console.log(this.tags)},handleInputConfirm:function(){var e=this.inputValue;e&&this.dynamicTags.push(e),this.inputVisible=!1,this.inputValue=""},dateTimeFormat:function(e,t,a,n){var o=a;return void 0==o?"":r()(o).format("YYYY-MM-DD")},search:function(){this.handleCurrentChange(1)},getDocsBySearchParam:function(){var e=this;this.loading=!0,Object(i["postJsonRequest"])("/public/getDocsBySearchParam",{pageInfo:{pageSize:this.pageSize,currentPage:this.currentPage},docLabels:this.$refs.tree.getCheckedNodes(),tags:this.tags,departmentId:this.selectDepartmentId,docName:this.docSearchName,selectYear:r()(this.selectYear).format("YYYY")}).then(function(t){if(200===t.data.code){console.log(t.data.data);for(var a=[],n=0;n<t.data.data.list.length;n++){var o=t.data.data.list[n],s={annexes:o.annexes,departmentId:o.departmentId,departmentName:o.departmentName,docId:o.docId,docLabels:o.docLabels,docName:o.docName,docPostTime:o.docPostTime,docSavePath:o.docSavePath,suffixName:o.suffixName,userId:o.userId,url:"/getName?name="+o.docName};a.push(s),console.log("table:"+a)}e.tableData=a,console.log(e.tableData),e.total=t.data.data.total,e.loading=!1}else e.loading=!1,console.log(t.data.msg)}).catch(function(t){e.loading=!1,console.log(t)}),console.log(this.currentPage+"currentPage")},getAllDocInfo:function(){var e=this;this.loading=!0,Object(i["getRequest"])("/public/getAllDocInfo",{pageSize:this.pageSize,currentPage:this.currentPage}).then(function(t){if(200===t.data.code){console.log(t.data.data);for(var a=[],n=0;n<t.data.data.list.length;n++){var o=t.data.data.list[n],s={annexes:o.annexes,departmentId:o.departmentId,departmentName:o.departmentName,docId:o.docId,docLabels:o.docLabels,docName:o.docName,docPostTime:o.docLabels,docSavePath:o.docSavePath,suffixName:o.suffixName,userId:o.userId,url:"/getName?name="+o.docName+"&token"};a.push(s)}e.tableData=a,e.total=t.data.data.total,e.loading=!1}else e.loading=!1,console.log(t.data.msg)}).catch(function(t){e.loading=!1,console.log(t)})},getMyChildDepartments:function(){var e=this;Object(i["getRequest"])("/admin/getMyChildDepartments").then(function(t){200===t.data.code?(e.departments=t.data.data,console.log(JSON.stringify(e.departments))):console.log(t.data.msg)}).catch(function(e){console.log(e)})},getDocLabelsTree:function(){var e=this;Object(i["getRequest"])("/public/getDocLabelsTree").then(function(t){200===t.data.code?(e.docLabelsTree=t.data.data,console.log(e.docLabelsTree)):console.log(t.data.msg)}).catch(function(e){console.log(e)})},getAllTags:function(){var e=this,t=this;Object(i["postJsonRequest"])("/public/getAllTags").then(function(a){console.log(a);for(var n=0;n<a.data.data.length;n++)if(1==a.data.data[n].isuse){var o={type:"normal",isuse:a.data.data[n].isuse,tagName:a.data.data[n].tagName,tagId:a.data.data[n].tagId};t.allTags.push(o)}console.log(e.tags),console.log("this.tags")}).catch(function(e){})},openMessageBox:function(e,t){var a=this;this.$confirm(e,"是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.dynamicTags.splice(a.dynamicTags.indexOf(t),1),a.$message({type:"success",message:"删除成功!"})}).catch(function(){a.$message({type:"info",message:"已取消删除"})})}},watch:{docSearchName:function(e){""!=e&&(this.docSearchName=e,console.log("docSearchName"+this.docSearchName))},filterText:function(e){console.log(e),this.$refs.tree.filter(e)},departs:function(e){null!=e&&0==e.length&&(this.selectDepartmentId=-1),console.log(this.selectDepartmentId),console.log("this.selectDepartmentId")}},mounted:function(){this.getAllTags(),this.getDocLabelsTree(),this.getMyChildDepartments(),this.getDocsBySearchParam(),this.getPagePermissions()},data:function(){var e;return e={loading:!0,src:"",currentPage1:1,pageCount:0,url:"",dialogVisible:!1,dialogVisible1:!1,departs:[],displayMode:"0",dynamicTags:["标签一","标签二","标签三"],inputVisible:!1,inputValue:"",selectYear:"",filterText:"",pageSize:7,currentPage:1,total:0,selectDepartmentId:-1},Object(s["a"])(e,"loading",!1),Object(s["a"])(e,"tableData",[]),Object(s["a"])(e,"docLabelsTree",[]),Object(s["a"])(e,"allTags",[]),Object(s["a"])(e,"tags",[]),Object(s["a"])(e,"fitterItems",[]),Object(s["a"])(e,"checkList",[]),Object(s["a"])(e,"allCheckList",[]),Object(s["a"])(e,"checkAll",!1),Object(s["a"])(e,"isIndeterminate",!0),Object(s["a"])(e,"time",[]),Object(s["a"])(e,"docSearchName",""),Object(s["a"])(e,"defaultOpeneds",["1"]),Object(s["a"])(e,"docLabels",[]),Object(s["a"])(e,"departments",[]),e}}),u=d,g=(a("b2a7"),a("2877")),p=Object(g["a"])(u,n,o,!1,null,null,null);t["default"]=p.exports},b2a7:function(e,t,a){"use strict";var n=a("cf11"),o=a.n(n);o.a},cf11:function(e,t,a){}}]);